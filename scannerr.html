

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Serial Number Capture</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body { 
            font-family: 'Inter', sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .card { 
            background-color: white; 
            border-radius: 1rem; 
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04); 
        }
        #video-container {
            position: relative;
            width: 100%;
            max-width: 500px;
            margin: 0 auto;
            border-radius: 1rem;
            overflow: hidden;
            background: #000;
        }
        #camera-feed {
            width: 100%;
            height: auto;
            display: block;
        }
        #canvas {
            display: none;
        }
        .capture-btn {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: white;
            border: 4px solid #667eea;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 10;
        }
        .capture-btn:hover {
            transform: translateX(-50%) scale(1.1);
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.6);
        }
        .capture-btn:active {
            transform: translateX(-50%) scale(0.95);
        }
        #captured-image {
            max-width: 100%;
            border-radius: 0.5rem;
            margin: 0 auto;
            display: block;
        }
        .serial-item {
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>
  <a href="first.html" class="nav-link" id="link-stock"> main menu</a>
<body class="p-4 md:p-8">

    <div class="max-w-4xl mx-auto">
        <!-- Header -->
        <header class="text-center mb-8">
            <h1 class="text-4xl md:text-5xl font-extrabold text-white mb-2">Serial Number Capture</h1>
            <p class="text-purple-100 text-lg">Capture and save serial numbers with timestamps</p>
        </header>

        <!-- Main Card -->
        <div class="card p-6 md:p-8 mb-6">
            <!-- Scan Button (Initial State) -->
            <div id="initial-view">
                <div class="text-center mb-6">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-24 w-24 mx-auto text-purple-600 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" />
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z" />
                    </svg>
                    <h2 class="text-2xl font-bold text-gray-800 mb-2">Ready to Scan</h2>
                    <p class="text-gray-600 mb-6">Click the button below to start capturing serial numbers</p>
                </div>
                <button onclick="startCamera()" 
                        class="w-full bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-700 hover:to-indigo-700 text-white font-bold py-4 px-6 rounded-xl transition duration-300 transform hover:scale-105 shadow-lg text-lg">
                    üì∑ Scan Serial Number
                </button>
            </div>

            <!-- Camera View -->
            <div id="camera-view" class="hidden">
                <h2 class="text-2xl font-bold text-gray-800 mb-4 text-center">Position Serial Number</h2>
                <p class="text-gray-600 mb-4 text-center">Click the white button to capture</p>
                
                <div id="video-container">
                    <video id="camera-feed" autoplay playsinline></video>
                    <button onclick="captureImage()" class="capture-btn" title="Capture"></button>
                </div>
                <canvas id="canvas"></canvas>

                <div class="mt-4 flex gap-2">
                    <button onclick="stopCamera()" 
                            class="flex-1 bg-red-500 hover:bg-red-600 text-white font-bold py-3 px-4 rounded-lg transition">
                        Cancel
                    </button>
                </div>
            </div>

            <!-- Captured Image View -->
            <div id="capture-view" class="hidden">
                <h2 class="text-2xl font-bold text-gray-800 mb-4 text-center">Captured Image</h2>
                
                <div class="mb-4 border-2 border-gray-300 rounded-lg p-2">
                    <img id="captured-image" alt="Captured serial number">
                </div>

                <div class="mb-4">
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Serial Number:</label>
                    <input type="text" id="serial-input" 
                           class="w-full p-3 border-2 border-gray-300 rounded-lg font-mono text-lg focus:border-purple-500 focus:outline-none" 
                           placeholder="Enter serial number from image...">
                </div>

                <div class="flex gap-2">
                    <button onclick="retakePhoto()" 
                            class="flex-1 bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-4 rounded-lg transition">
                        Retake
                    </button>
                    <button onclick="saveSerial()" 
                            class="flex-1 bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-lg transition">
                        Save Serial Number
                    </button>
                </div>
            </div>

            <!-- Status Messages -->
            <div id="status-message" class="mt-4 p-3 rounded-lg text-center font-medium hidden"></div>
        </div>

        <!-- Saved Serials List -->
        <div class="card p-6 md:p-8">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-gray-800">Saved Serial Numbers</h2>
                <span class="bg-purple-600 text-white px-4 py-2 rounded-full font-bold text-sm">
                    Total: <span id="total-count">0</span>
                </span>
            </div>

            <!-- Export Buttons -->
            <div class="flex gap-2 mb-6 flex-wrap">
                <button onclick="exportToCSV()" 
                        class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition text-sm">
                    üì• Export CSV
                </button>
                <button onclick="exportToJSON()" 
                        class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-lg transition text-sm">
                    üì• Export JSON
                </button>
                <button onclick="clearAllSerials()" 
                        class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg transition text-sm">
                    üóëÔ∏è Clear All
                </button>
            </div>

            <!-- Search Bar -->
            <div class="mb-4">
                <input type="text" id="search-input" 
                       onkeyup="searchSerials()" 
                       class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:outline-none" 
                       placeholder="üîç Search serial numbers...">
            </div>

            <!-- Serials Table -->
            <div class="overflow-x-auto">
                <table class="min-w-full">
                    <thead class="bg-gradient-to-r from-purple-600 to-indigo-600 text-white">
                        <tr>
                            <th class="px-4 py-3 text-left text-sm font-semibold uppercase tracking-wider rounded-tl-lg">#</th>
                            <th class="px-4 py-3 text-left text-sm font-semibold uppercase tracking-wider">Serial Number</th>
                            <th class="px-4 py-3 text-left text-sm font-semibold uppercase tracking-wider">Date & Time</th>
                            <th class="px-4 py-3 text-left text-sm font-semibold uppercase tracking-wider rounded-tr-lg">Action</th>
                        </tr>
                    </thead>
                    <tbody id="serials-list" class="divide-y divide-gray-200">
                        <!-- Serial numbers will be inserted here -->
                    </tbody>
                </table>
            </div>

            <p id="empty-state" class="text-center py-12 text-gray-500 text-lg">
                No serial numbers saved yet. Start scanning to add entries.
            </p>
        </div>
    </div>

    <script>
        // State variables
        let stream = null;
        let serialNumbers = [];
        const STORAGE_KEY = 'serial_numbers_data';

        // Load saved serials on page load
        window.onload = () => {
            loadSerials();
            displaySerials();
        };

        // Load serials from localStorage
        function loadSerials() {
            const stored = localStorage.getItem(STORAGE_KEY);
            if (stored) {
                try {
                    serialNumbers = JSON.parse(stored);
                } catch (e) {
                    console.error('Error loading serials:', e);
                    serialNumbers = [];
                }
            }
        }

        // Save serials to localStorage
        function saveToStorage() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(serialNumbers));
        }

        // Start camera
        async function startCamera() {
            try {
                stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { facingMode: 'environment' },
                    audio: false 
                });
                
                const video = document.getElementById('camera-feed');
                video.srcObject = stream;

                document.getElementById('initial-view').classList.add('hidden');
                document.getElementById('camera-view').classList.remove('hidden');
                
                showStatus('Camera ready! Position the serial number and click capture.', 'info');
            } catch (error) {
                console.error('Error accessing camera:', error);
                showStatus('Could not access camera. Please check permissions.', 'error');
            }
        }

        // Stop camera
        function stopCamera() {
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
                stream = null;
            }
            
            document.getElementById('camera-view').classList.add('hidden');
            document.getElementById('capture-view').classList.add('hidden');
            document.getElementById('initial-view').classList.remove('hidden');
            
            // Clear the video
            const video = document.getElementById('camera-feed');
            video.srcObject = null;
        }

        // Capture image
        function captureImage() {
            const video = document.getElementById('camera-feed');
            const canvas = document.getElementById('canvas');
            const context = canvas.getContext('2d');

            // Set canvas size to match video
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;

            // Draw video frame to canvas
            context.drawImage(video, 0, 0, canvas.width, canvas.height);

            // Get image data
            const imageData = canvas.toDataURL('image/jpeg', 0.8);
            
            // Display captured image
            document.getElementById('captured-image').src = imageData;

            // Stop camera and show capture view
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
                stream = null;
            }

            document.getElementById('camera-view').classList.add('hidden');
            document.getElementById('capture-view').classList.remove('hidden');
            
            // Focus on serial input
            document.getElementById('serial-input').focus();
            
            showStatus('Image captured! Enter the serial number and save.', 'success');
            
            // Vibrate if supported
            if (navigator.vibrate) {
                navigator.vibrate(200);
            }
        }

        // Retake photo
        function retakePhoto() {
            document.getElementById('capture-view').classList.add('hidden');
            document.getElementById('serial-input').value = '';
            startCamera();
        }

        // Save serial number
        function saveSerial() {
            const serialInput = document.getElementById('serial-input');
            const serialNumber = serialInput.value.trim();

            if (!serialNumber) {
                showStatus('Please enter a serial number', 'error');
                return;
            }

            // Create serial entry
            const entry = {
                id: Date.now(),
                serial: serialNumber,
                date: new Date().toISOString(),
                image: document.getElementById('captured-image').src
            };

            // Add to array
            serialNumbers.unshift(entry); // Add to beginning
            
            // Save to storage
            saveToStorage();

            // Update display
            displaySerials();

            // Reset view
            document.getElementById('capture-view').classList.add('hidden');
            document.getElementById('initial-view').classList.remove('hidden');
            serialInput.value = '';

            showStatus('Serial number saved successfully!', 'success');
            
            // Vibrate if supported
            if (navigator.vibrate) {
                navigator.vibrate([100, 50, 100]);
            }
        }

        // Display serials in table
        function displaySerials(filter = '') {
            const tbody = document.getElementById('serials-list');
            const emptyState = document.getElementById('empty-state');
            const totalCount = document.getElementById('total-count');

            tbody.innerHTML = '';

            let filteredSerials = serialNumbers;
            if (filter) {
                filteredSerials = serialNumbers.filter(item => 
                    item.serial.toLowerCase().includes(filter.toLowerCase())
                );
            }

            totalCount.textContent = serialNumbers.length;

            if (filteredSerials.length === 0) {
                emptyState.classList.remove('hidden');
                tbody.parentElement.classList.add('hidden');
            } else {
                emptyState.classList.add('hidden');
                tbody.parentElement.classList.remove('hidden');

                filteredSerials.forEach((item, index) => {
                    const date = new Date(item.date);
                    const formattedDate = date.toLocaleDateString('en-US', { 
                        month: 'short', 
                        day: 'numeric', 
                        year: 'numeric' 
                    });
                    const formattedTime = date.toLocaleTimeString('en-US', { 
                        hour: '2-digit', 
                        minute: '2-digit' 
                    });

                    const row = document.createElement('tr');
                    row.className = 'serial-item hover:bg-purple-50 transition';
                    row.innerHTML = `
                        <td class="px-4 py-4 text-sm font-medium text-gray-900">${index + 1}</td>
                        <td class="px-4 py-4 text-sm font-mono font-semibold text-purple-700">${item.serial}</td>
                        <td class="px-4 py-4 text-sm text-gray-600">
                            <div>${formattedDate}</div>
                            <div class="text-xs text-gray-500">${formattedTime}</div>
                        </td>
                        <td class="px-4 py-4 text-sm">
                            <button onclick="viewImage(${item.id})" 
                                    class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded mr-2 text-xs font-semibold transition">
                                View
                            </button>
                            <button onclick="deleteSerial(${item.id})" 
                                    class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-xs font-semibold transition">
                                Delete
                            </button>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
            }
        }

        // Search serials
        function searchSerials() {
            const searchTerm = document.getElementById('search-input').value;
            displaySerials(searchTerm);
        }

        // View image
        function viewImage(id) {
            const item = serialNumbers.find(s => s.id === id);
            if (item && item.image) {
                const win = window.open();
                win.document.write(`
                    <html>
                    <head><title>Serial: ${item.serial}</title></head>
                    <body style="margin:0;display:flex;align-items:center;justify-content:center;background:#000;">
                        <img src="${item.image}" style="max-width:100%;max-height:100vh;">
                    </body>
                    </html>
                `);
            }
        }

        // Delete serial
        function deleteSerial(id) {
            if (confirm('Are you sure you want to delete this serial number?')) {
                serialNumbers = serialNumbers.filter(s => s.id !== id);
                saveToStorage();
                displaySerials();
                showStatus('Serial number deleted', 'success');
            }
        }

        // Clear all serials
        function clearAllSerials() {
            if (serialNumbers.length === 0) {
                showStatus('No serials to clear', 'error');
                return;
            }

            if (confirm(`Are you sure you want to delete all ${serialNumbers.length} serial numbers? This cannot be undone.`)) {
                serialNumbers = [];
                saveToStorage();
                displaySerials();
                showStatus('All serial numbers cleared', 'success');
            }
        }

        // Export to CSV
        function exportToCSV() {
            if (serialNumbers.length === 0) {
                showStatus('No data to export', 'error');
                return;
            }

            let csv = 'Serial Number,Date,Time\n';
            serialNumbers.forEach(item => {
                const date = new Date(item.date);
                const dateStr = date.toLocaleDateString('en-US');
                const timeStr = date.toLocaleTimeString('en-US');
                csv += `"${item.serial}","${dateStr}","${timeStr}"\n`;
            });

            downloadFile(csv, `serial_numbers_${Date.now()}.csv`, 'text/csv');
            showStatus('CSV exported successfully!', 'success');
        }

        // Export to JSON
        function exportToJSON() {
            if (serialNumbers.length === 0) {
                showStatus('No data to export', 'error');
                return;
            }

            const json = JSON.stringify(serialNumbers, null, 2);
            downloadFile(json, `serial_numbers_${Date.now()}.json`, 'application/json');
            showStatus('JSON exported successfully!', 'success');
        }

        // Download file helper
        function downloadFile(content, filename, type) {
            const blob = new Blob([content], { type: type });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = filename;
            link.click();
            URL.revokeObjectURL(url);
        }

        // Show status message
        function showStatus(message, type = 'info') {
            const statusEl = document.getElementById('status-message');
            statusEl.textContent = message;
            statusEl.classList.remove('hidden', 'bg-blue-100', 'text-blue-700', 'bg-green-100', 'text-green-700', 'bg-red-100', 'text-red-700');
            
            if (type === 'success') {
                statusEl.classList.add('bg-green-100', 'text-green-700');
            } else if (type === 'error') {
                statusEl.classList.add('bg-red-100', 'text-red-700');
            } else {
                statusEl.classList.add('bg-blue-100', 'text-blue-700');
            }

            statusEl.classList.remove('hidden');

            setTimeout(() => {
                statusEl.classList.add('hidden');
            }, 3000);
        }
    </script>

</body>
</html>
